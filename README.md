# **"Sentry —Å –≤–Ω–µ—à–Ω–∏–º–∏ Kafka, ClickHouse, Postgres, Redis (–∏ –Ω–µ–º–Ω–æ–≥–æ Terraform –º–∞–≥–∏–∏)"**

## –í —ç—Ç–æ–º –ø–æ—Å—Ç–µ

- –ö—Ä–∞—Ç–∫–æ –æ Sentry: —á—Ç–æ —ç—Ç–æ, –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω
- –ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ –≤—ã–Ω–æ—Å–∏—Ç—å Kafka, Redis, ClickHouse, Postgres –≤–Ω–µ Kubernetes
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Kafka, Redis, ClickHouse, Postgres —á–µ—Ä–µ–∑ SSL
- –•—Ä–∞–Ω–µ–Ω–∏–µ debug —Ñ–∞–π–ª–æ–≤ –∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Nodestore) –≤ S3
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ values.yaml
- –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–∏–µ –ø–æ—Å—Ç—ã –æ Sentry

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

- –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—â–µ–π —Å—Ö–µ–º—ã:
    - Sentry –≤ Kubernetes (–∏–ª–∏ –Ω–∞ VM)
    - –í–Ω–µ—à–Ω–∏–µ managed —Å–µ—Ä–≤–∏—Å—ã: Kafka, Redis, ClickHouse, Postgres
    - –•—Ä–∞–Ω–µ–Ω–∏–µ blob-–¥–∞–Ω–Ω—ã—Ö –≤ S3 (nodestore/filestore)
- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ, —á—Ç–æ –≤—Å—ë –æ–ø–∏—Å–∞–Ω–æ –≤ Terraform

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Terraform –ø—Ä–æ–µ–∫—Ç–∞

- –°–ø–∏—Å–æ–∫ –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:
    - `clickhouse.tf` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ ClickHouse
    - `kafka.tf` ‚Äî managed Kafka (Yandex Cloud)
    - `postgres.tf` ‚Äî –±–∞–∑–∞ –ø–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π Sentry
    - `redis.tf` ‚Äî –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—á–µ—Ä–µ–¥–µ–π
    - `s3_filestore.tf` –∏ `s3_nodestore.tf` ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ blob-–¥–∞–Ω–Ω—ã—Ö
    - `sentry_config.yaml` –∏ `sentry_config.yaml.tpl` ‚Äî –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è Sentry, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑—É–µ–º —á–µ—Ä–µ–∑ Terraform `templatefile`
    - `k8s.tf` ‚Äî –¥–µ–ø–ª–æ–π Sentry –≤ –∫–ª–∞—Å—Ç–µ—Ä
    - `example-python/` ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è, –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏ –≤ Sentry –∏–∑ Python

üõ†Ô∏è –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å:
- `locals.tf`, `net.tf`, `ip-dns.tf`, `versions.tf` ‚Äî –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∏ —Å–µ—Ç–µ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Sentry

- –ö–∞–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è Sentry —á–µ—Ä–µ–∑ `sentry_config.yaml.tpl`
- –ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
    - `SENTRY_REDIS_HOST`
    - `SENTRY_DB_NAME`
    - `KAFKA_BROKER_URL`
    - `SENTRY_EVENT_RETENTION_DAYS`
- –ö–∞–∫ —à–∞–±–ª–æ–Ω –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ (—á–µ—Ä–µ–∑ `templatefile()` –≤ Terraform)

---

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (`example-python`)

- –ß—Ç–æ –ª–µ–∂–∏—Ç –≤ `example-python/`
- –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Sentry SDK
- –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –≤—ã–±—Ä–æ—Å–∞ exception‚Äô–∞:

## –ö–∞–∫ –≤—Å—ë —ç—Ç–æ —Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
–ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```shell
terraform init
terraform apply
```
–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (terraform output)
–ì–µ–Ω–µ—Ä–∏–º –∫–æ–Ω—Ñ–∏–≥ sentry_config.yaml –∏–∑ —à–∞–±–ª–æ–Ω–∞
–î–µ–ø–ª–æ–∏–º Sentry –≤ –∫–ª–∞—Å—Ç–µ—Ä (—á–µ—Ä–µ–∑ Helm –∏–ª–∏ kubectl apply)


## –ü–æ–¥–≤–æ–¥–∏–º –∏—Ç–æ–≥–∏
–ü–ª—é—Å—ã —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

* –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
* –ò–∑–æ–ª—è—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
* –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

–ú–∏–Ω—É—Å—ã/–ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è:

* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ
* –¢—Ä–µ–±—É–µ—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ IAM-–¥–æ—Å—Ç—É–ø–æ–≤ (–æ—Å–æ–±–µ–Ω–Ω–æ –∫ S3)
